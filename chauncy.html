<!DOCTYPE html>
<html>
  <head>
    <!-- AngularJS -->
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.5/angular.min.js"></script>
    <!-- Jquery -->
    <script src='https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js'></script>
    <!-- Firebase -->
    <script src='https://cdn.firebase.com/js/client/2.2.1/firebase.js'></script>
    <!-- Angular Fire -->
    <script src="https://cdn.firebase.com/libs/angularfire/1.0.0/angularfire.min.js"></script>
    <title>Chauncy Crib</title>
  </head>

  <body ng-app="webApp" ng-controller="MainController" style="background-color: black; color: white;">

    <div id="theCrib"></div>

    <div class='refresh'>
      <a style='font-size: 80%; color: white;'>Refresh for more</a>
      <a class='btn' style='font-size: 80%; color: white;'>.</a><br><br>
    </div>
    
    <div class='newMessage'>
      <input type='text' class='newMessageText' placeholder='Add a new dank message' size='30' style='font-size: 25px;'>
      <input type='button' class='newMessageBtn' value='Submit the dank' style='font-size: 25px;'><br><br>
      <ul class='messageList'>
        <li ng-repeat='quote in quotesList'>
          {{ quote.text }}
        </li>
      </ul>
    </div>

    <script>
      var webApp = angular.module('webApp', ['firebase']);

      webApp.controller('MainController', ['$scope', '$firebaseArray',
        function($scope, $firebaseArray) {

        $('.newMessage').toggle();
        $('.refresh').toggle();
        $scope.test = 'working';

        var database = new Firebase('https://flickering-inferno-875.firebaseio.com/');
        $scope.quotesList = $firebaseArray(database);
  
        $scope.clientQuotesList = [];

        database.on('child_added', function(snapshot) {
          var message = snapshot.val();
          $scope.clientQuotesList.push(message.text);
        });

        // $scope.quotesList.$add({text: "So dope you'll get high off the fumes."});
        // $scope.quotesList.$add({text: "Because doorknobs are for suckers."});
        // $scope.quotesList.$add({text: "Because indoor lighting is for amateurs."});
        // $scope.quotesList.$add({text: "Now with 100% more bedroom."});
        // $scope.quotesList.$add({text: "They call us the submorers."});

        $scope.destroy = function(quote) {
          $scope.quotesList.$remove(quote);
        };

        $scope.random255 = function() {
          return Math.floor(Math.random()*255).toString();
        };

        $scope.setRandomColor = function() {
          var randomColor = ("rgb(" + $scope.random255() + ", " +
            $scope.random255() + ", " + $scope.random255() + ")");
          document.getElementById("theCrib").innerHTML=("<h1 style='font"+
            "-size: 1000%; color: "+randomColor+";'>The Chauncy Crib</"+
            "h1><p style='font-size: 500%; color: "+randomColor+";'>"+
          $scope.randomQuote+"</p>");
          setTimeout($scope.setRandomColor, 100);
        };

        $('.btn').click(function() {
          $('.newMessage').toggle();
        });

        $('.newMessageBtn').click(function() {
          var newText = $('.newMessageText').val();
          database.push({text: newText});
          $('.newMessageText').val('');
        });

        $scope.run = function() {
          $scope.randomQuote = $scope.clientQuotesList[Math.floor(Math.random()*$scope.clientQuotesList.length)];
          $('.refresh').toggle();
          $scope.setRandomColor();
        }

        setTimeout($scope.run, 1000);
      }
    ]);

    </script>
  </body>
</html>

